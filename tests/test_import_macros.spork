; Test import-macros feature
; Tests compile-time macro importing from other modules

(print "=== Testing import-macros ===\n")

; ============================================================================
; 1. Import macros from test_macro module
; ============================================================================

(print "--- 1. Import my-when from test_macro ---")

(import-macros tests.test_macro [my-when])

(def result1 (my-when true 42))
(print "my-when true 42:" result1)
(assert (= result1 42))

(def result1b (my-when false 100))
(print "my-when false 100:" result1b)
(assert (= result1b nil))

(print "✓ Imported my-when macro works\n")

; ============================================================================
; 2. Import macros from test_macros module
; ============================================================================

(print "--- 2. Import when and unless from test_macros ---")

(import-macros tests.test_macros [when unless])

(def result2a (when true "yes"))
(print "when true:" result2a)
(assert (= result2a "yes"))

(def result2b (when false "no"))
(print "when false:" result2b)
(assert (= result2b nil))

(def result2c (unless false "correct"))
(print "unless false:" result2c)
(assert (= result2c "correct"))

(def result2d (unless true "wrong"))
(print "unless true:" result2d)
(assert (= result2d nil))

(print "✓ Imported when and unless macros work\n")

; ============================================================================
; 3. Import threading macro from test_macros
; ============================================================================

(print "--- 3. Import -> threading macro from test_macros ---")

(import-macros tests.test_macros [->])

(def result3 (-> 5 (+ 3)))
(print "-> 5 (+ 3):" result3)
(assert (= result3 8))

(print "✓ Imported threading macro works\n")

; ============================================================================
; 4. Use imported macros together
; ============================================================================

(print "--- 4. Use imported macros together ---")

(def result4 (my-when true (-> 10 (+ 5))))
(print "my-when true (-> 10 (+ 5)):" result4)
(assert (= result4 15))

(print "✓ Combined imported macros work\n")

; ============================================================================
; 5. Define local macro that uses imported macro
; ============================================================================

(print "--- 5. Local macro using imported macro ---")

(defmacro double-when [test x]
  `(my-when ~test (* 2 ~x)))

(def result5 (double-when true 21))
(print "double-when true 21:" result5)
(assert (= result5 42))

(def result5b (double-when false 21))
(print "double-when false 21:" result5b)
(assert (= result5b nil))

(print "✓ Local macro using imported macro works\n")

; ============================================================================
; 6. Test qualified macro access (module.macro-name)
; ============================================================================

(print "--- 6. Qualified macro access ---")

(def result6 (tests.test_macro.my-when true 999))
(print "tests.test_macro.my-when true 999:" result6)
(assert (= result6 999))

(print "✓ Qualified macro access works\n")

; ============================================================================
; Summary
; ============================================================================

(print "=== All import-macros Tests Passed! ===")
(print "✓ Import single macro from module")
(print "✓ Import multiple macros from module")
(print "✓ Import threading macro")
(print "✓ Combined imported macros")
(print "✓ Local macro using imported macro")
(print "✓ Qualified macro access")
(print "")
